<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Play with Models</title>
  </head>
  <style>
    .ac {
      user-select: none;
    }
    .control-inactive {
      color: gray;
    }
  </style>
  <body></body>
  <script type="module">
    import * as THREE from "../../build/three.module.js";
    import { OrbitControls } from "../jsm/controls/OrbitControls.js";
    import { GLTFLoader } from "../jsm/loaders/GLTFLoader.js";
    import { GUI } from "./jsm/libs/dat.gui.module.js";

    var renderer, scene, camera;
    var model, skeleton, mixer, clock;
    var controls;

    var crossFadeControls = [];

    let currentAction = "idle";
    const allActions = [];
    const baseActions = {
      idle: { weight: 1 },
      walk: { weigth: 0 },
      run: { weight: 0 },
    };

    const additiveActions = {
      sneak_pose: { weight: 0 },
      sad_pose: { weight: 0 },
      agree: { weight: 0 },
      headShake: { weight: 0 },
    };

    var panelSettings, numAnimations;

    var lightColor = "#fff";
    init();
    animate();
    function init() {
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      renderer.outputEncoding = THREE.sRGBEncoding;
      document.body.appendChild(renderer.domElement);

      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(
        45,
        window.innerWidth / window.innerHeight,
        1,
        2000
      );
      camera.position.set(-15, 15, -50);

      var loader = new GLTFLoader();
      loader.setDRACOLoader(dracoLoader);
      loader.load("../models/gltf/ferrari.glb", function (gltf) {
        car = gltf.scene.children[0];
        var s = 5;
        car.scale.set(s, s, s);

        var texture = new THREE.TextureLoader().load(
          "../models/gltf/ferrari_ao.png"
        );
        var shadow = new THREE.Mesh(
          new THREE.PlaneBufferGeometry(0.644 * 4, 1.3 * 4),
          new THREE.MeshBasicMaterial({
            map: texture,
            opacity: 0.8,
            transparent: true,
          })
        );
      });
      var ambient = new THREE.AmbientLight(0xffffff, 1);
      scene.add(ambient);

      var groundGeom = new THREE.PlaneBufferGeometry(80, 80);
      var groundMat = new THREE.MeshStandardMaterial({
        color: 0x000000,
        roughness: 0.5,
      });
      var ground = new THREE.Mesh(groundGeom, groundMat);
      ground.rotateX(-Math.PI / 2);
      ground.receiveShadow = true;

      scene.add(ground);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;

      controls.screenSpacePanning = false;
      (controls.minDistance = 1), (controls.maxDistance = 200);
      controls.enablePanning = false;
      controls.maxPolarAngle = Math.PI / 3;
      controls.minPolarAngle = Math.PI / 8;

      //controls.maxAzimuthAngle = -3 * Math.PI / 4;
      // controls.minAzimuthAngle = 3 * Math.PI / 4;
    }
    function animate() {
      requestAnimationFrame(animate);
      render();
    }
    function render() {
      renderer.render(scene, camera);
    }
  </script>
</html>
